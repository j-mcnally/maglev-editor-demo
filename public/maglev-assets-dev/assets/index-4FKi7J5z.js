const p=e=>e==null||typeof e=="string"&&e.length===0||typeof e=="object"&&e.length===0,k=(e,t)=>{let o;function n(...s){o&&clearTimeout(o),o=setTimeout(()=>{o=null,e(...s)},t)}return n};let g=null;const w=e=>{const t=window.document;t.head.insertAdjacentHTML("beforeend",`<style type="text/css">:root { --maglev-editor-outline-color: ${e.primaryColor}; }</style>`),y(t),u(t,"mouseenter",(o,n)=>{switch(n){case"section":return v(t,o,e.stickySectionIds);case"setting":return h(o)}}),u(t,"mouseleave",(o,n)=>{switch(n){case"section":return b();case"setting":return I(o)}}),u(t,"click",(o,n,s)=>{switch(n){case"setting":return C(o,s)}}),x(t)},u=(e,t,o)=>{const n=t==="mouseenter"||t==="mouseleave";l(e.body,t,s=>{if(s.target===e)return;let i=s.target.closest("[data-maglev-section-id]"),c=s.target.closest("[data-maglev-id]"),d=c||i;if(d){if(t==="mouseleave")if(c){if(c!=s.target)return}else{if(i!=s.target)return;const a=i.getBoundingClientRect(),m=e.defaultView.scrollX,f=e.defaultView.scrollY;if(s.pageX>a.left+m&&s.pageX<a.right+m&&s.pageY>a.top+f&&s.pageY<a.bottom+f)return}o(d,E(d),s)}},n)},y=e=>{let t=0,o=0;l(e,"mousemove",s=>{t=s.clientX,o=s.clientY});const n=k(()=>{var i;const s=(i=e.elementFromPoint(t,o))==null?void 0:i.closest("[data-maglev-section-id]");s&&r("scroll",{boundingRect:s.getBoundingClientRect()})},10);l(e,"scroll",n)},v=(e,t,o)=>{const n=t.dataset.maglevSectionId;g!==n&&(r("section:hover",{sectionId:n,sectionRect:t.getBoundingClientRect(),sectionOffsetTop:S(e,n,o)}),g=n)},S=(e,t,o)=>{for(var n=0;n<o.length;n++){const s=o[n];if(s===t)return 0;const i=`[data-maglev-section-id='${s}']`,c=e.querySelector(i);if(c)return c.offsetHeight}return 0},b=()=>{r("section:leave"),g=null},h=e=>{if(!e)return null;e.style.outline="2px solid transparent",e.style.outlineOffset="2px",e.style.boxShadow="0 0 0 2px var(--maglev-editor-outline-color)",!e.style.borderRadius&&window.getComputedStyle(e).borderRadius==="0px"&&(e.style.borderRadius="2px")},I=e=>{e.style.boxShadow="none"},C=(e,t)=>{t.stopPropagation()&t.preventDefault();const o=e.dataset.maglevId.split("."),s=!!e.closest("[data-maglev-block-id]")?"sectionBlock":"section";r(`${s}:setting:clicked`,{[`${s}Id`]:o[0],settingId:o[1]})},l=(e,t,o,n)=>{e.addEventListener(t,o,n)},x=e=>{l(e.body,"click",t=>{const o=t.target.closest("a");if(o&&!p(o.href))return t.stopPropagation()&t.preventDefault(),!1})},E=e=>e.dataset.maglevSectionId?"section":"setting",R=window.parent,B=()=>{window.addEventListener("message",({data:{type:e,...t}})=>{if(e)switch(e){case"config":w({primaryColor:t.primaryColor,stickySectionIds:t.stickySectionIds}),r("ready",{message:"ðŸ‘‹, I'm a Maglev site and I'm ready"});break;case"section:add":case"section:move":case"section:update":case"section:remove":case"block:add":case"block:move":case"block:update":case"block:remove":case"style:update":L(e,t);break;default:console.log("[maglev][iframe] unknown message type",e);break}})},r=(e,t)=>{R.postMessage({type:e,...t||{}},"*")},L=(e,t)=>{const o=new CustomEvent(`maglev:${e}`,{detail:t});window.dispatchEvent(o)},M=()=>window.location===window.parent.location?!1:(B(),!0),X={start:M};export{X as C,k as d};
